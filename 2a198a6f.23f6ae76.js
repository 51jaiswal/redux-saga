/*! For license information please see 2a198a6f.23f6ae76.js.LICENSE.txt */
(window.webpackJsonp=window.webpackJsonp||[]).push([[6],{107:function(e,t,n){"use strict";n.d(t,"a",(function(){return p})),n.d(t,"b",(function(){return b}));var r=n(0),a=n.n(r);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function c(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var u=a.a.createContext({}),s=function(e){var t=a.a.useContext(u),n=t;return e&&(n="function"==typeof e?e(t):c(c({},t),e)),n},p=function(e){var t=s(e.components);return a.a.createElement(u.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return a.a.createElement(a.a.Fragment,{},t)}},f=a.a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,o=e.originalType,i=e.parentName,u=l(e,["components","mdxType","originalType","parentName"]),p=s(n),f=r,b=p["".concat(i,".").concat(f)]||p[f]||d[f]||o;return n?a.a.createElement(b,c(c({ref:t},u),{},{components:n})):a.a.createElement(b,c({ref:t},u))}));function b(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=n.length,i=new Array(o);i[0]=f;var c={};for(var l in t)hasOwnProperty.call(t,l)&&(c[l]=t[l]);c.originalType=e,c.mdxType="string"==typeof e?e:r,i[1]=c;for(var u=2;u<o;u++)i[u]=n[u];return a.a.createElement.apply(null,i)}return a.a.createElement.apply(null,n)}f.displayName="MDXCreateElement"},108:function(e,t,n){"use strict";e.exports=n(109)},109:function(e,t,n){"use strict";var r=n(110),a="function"==typeof Symbol&&Symbol.for,o=a?Symbol.for("react.element"):60103,i=a?Symbol.for("react.portal"):60106,c=a?Symbol.for("react.fragment"):60107,l=a?Symbol.for("react.strict_mode"):60108,u=a?Symbol.for("react.profiler"):60114,s=a?Symbol.for("react.provider"):60109,p=a?Symbol.for("react.context"):60110,d=a?Symbol.for("react.forward_ref"):60112,f=a?Symbol.for("react.suspense"):60113,b=a?Symbol.for("react.suspense_list"):60120,h=a?Symbol.for("react.memo"):60115,y=a?Symbol.for("react.lazy"):60116;a&&Symbol.for("react.fundamental"),a&&Symbol.for("react.responder"),a&&Symbol.for("react.scope");var m="function"==typeof Symbol&&Symbol.iterator;function g(e){for(var t=e.message,n="https://reactjs.org/docs/error-decoder.html?invariant="+t,r=1;r<arguments.length;r++)n+="&args[]="+encodeURIComponent(arguments[r]);return e.message="Minified React error #"+t+"; visit "+n+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings. ",e}var O={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},v={};function j(e,t,n){this.props=e,this.context=t,this.refs=v,this.updater=n||O}function w(){}function C(e,t,n){this.props=e,this.context=t,this.refs=v,this.updater=n||O}j.prototype.isReactComponent={},j.prototype.setState=function(e,t){if("object"!=typeof e&&"function"!=typeof e&&null!=e)throw g(Error(85));this.updater.enqueueSetState(this,e,t,"setState")},j.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},w.prototype=j.prototype;var N=C.prototype=new w;N.constructor=C,r(N,j.prototype),N.isPureReactComponent=!0;var R={current:null},k={suspense:null},E={current:null},x=Object.prototype.hasOwnProperty,S={key:!0,ref:!0,__self:!0,__source:!0};function I(e,t,n){var r,a={},i=null,c=null;if(null!=t)for(r in void 0!==t.ref&&(c=t.ref),void 0!==t.key&&(i=""+t.key),t)x.call(t,r)&&!S.hasOwnProperty(r)&&(a[r]=t[r]);var l=arguments.length-2;if(1===l)a.children=n;else if(1<l){for(var u=Array(l),s=0;s<l;s++)u[s]=arguments[s+2];a.children=u}if(e&&e.defaultProps)for(r in l=e.defaultProps)void 0===a[r]&&(a[r]=l[r]);return{$$typeof:o,type:e,key:i,ref:c,props:a,_owner:E.current}}function _(e){return"object"==typeof e&&null!==e&&e.$$typeof===o}var P=/\/+/g,T=[];function A(e,t,n,r){if(T.length){var a=T.pop();return a.result=e,a.keyPrefix=t,a.func=n,a.context=r,a.count=0,a}return{result:e,keyPrefix:t,func:n,context:r,count:0}}function U(e){e.result=null,e.keyPrefix=null,e.func=null,e.context=null,e.count=0,10>T.length&&T.push(e)}function D(e,t,n,r){var a=typeof e;"undefined"!==a&&"boolean"!==a||(e=null);var c=!1;if(null===e)c=!0;else switch(a){case"string":case"number":c=!0;break;case"object":switch(e.$$typeof){case o:case i:c=!0}}if(c)return n(r,e,""===t?"."+H(e,0):t),1;if(c=0,t=""===t?".":t+":",Array.isArray(e))for(var l=0;l<e.length;l++){var u=t+H(a=e[l],l);c+=D(a,u,n,r)}else if(null===e||"object"!=typeof e?u=null:u="function"==typeof(u=m&&e[m]||e["@@iterator"])?u:null,"function"==typeof u)for(e=u.call(e),l=0;!(a=e.next()).done;)c+=D(a=a.value,u=t+H(a,l++),n,r);else if("object"===a)throw n=""+e,g(Error(31),"[object Object]"===n?"object with keys {"+Object.keys(e).join(", ")+"}":n,"");return c}function $(e,t,n){return null==e?0:D(e,"",t,n)}function H(e,t){return"object"==typeof e&&null!==e&&null!=e.key?function(e){var t={"=":"=0",":":"=2"};return"$"+(""+e).replace(/[=:]/g,(function(e){return t[e]}))}(e.key):t.toString(36)}function q(e,t){e.func.call(e.context,t,e.count++)}function L(e,t,n){var r=e.result,a=e.keyPrefix;e=e.func.call(e.context,t,e.count++),Array.isArray(e)?F(e,r,n,(function(e){return e})):null!=e&&(_(e)&&(e=function(e,t){return{$$typeof:o,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}(e,a+(!e.key||t&&t.key===e.key?"":(""+e.key).replace(P,"$&/")+"/")+n)),r.push(e))}function F(e,t,n,r,a){var o="";null!=n&&(o=(""+n).replace(P,"$&/")+"/"),$(e,L,t=A(t,o,r,a)),U(t)}function G(){var e=R.current;if(null===e)throw g(Error(321));return e}var M={Children:{map:function(e,t,n){if(null==e)return e;var r=[];return F(e,r,null,t,n),r},forEach:function(e,t,n){if(null==e)return e;$(e,q,t=A(null,null,t,n)),U(t)},count:function(e){return $(e,(function(){return null}),null)},toArray:function(e){var t=[];return F(e,t,null,(function(e){return e})),t},only:function(e){if(!_(e))throw g(Error(143));return e}},createRef:function(){return{current:null}},Component:j,PureComponent:C,createContext:function(e,t){return void 0===t&&(t=null),(e={$$typeof:p,_calculateChangedBits:t,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null}).Provider={$$typeof:s,_context:e},e.Consumer=e},forwardRef:function(e){return{$$typeof:d,render:e}},lazy:function(e){return{$$typeof:y,_ctor:e,_status:-1,_result:null}},memo:function(e,t){return{$$typeof:h,type:e,compare:void 0===t?null:t}},useCallback:function(e,t){return G().useCallback(e,t)},useContext:function(e,t){return G().useContext(e,t)},useEffect:function(e,t){return G().useEffect(e,t)},useImperativeHandle:function(e,t,n){return G().useImperativeHandle(e,t,n)},useDebugValue:function(){},useLayoutEffect:function(e,t){return G().useLayoutEffect(e,t)},useMemo:function(e,t){return G().useMemo(e,t)},useReducer:function(e,t,n){return G().useReducer(e,t,n)},useRef:function(e){return G().useRef(e)},useState:function(e){return G().useState(e)},Fragment:c,Profiler:u,StrictMode:l,Suspense:f,unstable_SuspenseList:b,createElement:I,cloneElement:function(e,t,n){if(null==e)throw g(Error(267),e);var a=r({},e.props),i=e.key,c=e.ref,l=e._owner;if(null!=t){if(void 0!==t.ref&&(c=t.ref,l=E.current),void 0!==t.key&&(i=""+t.key),e.type&&e.type.defaultProps)var u=e.type.defaultProps;for(s in t)x.call(t,s)&&!S.hasOwnProperty(s)&&(a[s]=void 0===t[s]&&void 0!==u?u[s]:t[s])}var s=arguments.length-2;if(1===s)a.children=n;else if(1<s){u=Array(s);for(var p=0;p<s;p++)u[p]=arguments[p+2];a.children=u}return{$$typeof:o,type:e.type,key:i,ref:c,props:a,_owner:l}},createFactory:function(e){var t=I.bind(null,e);return t.type=e,t},isValidElement:_,version:"16.10.2",unstable_withSuspenseConfig:function(e,t){var n=k.suspense;k.suspense=void 0===t?null:t;try{e()}finally{k.suspense=n}},__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED:{ReactCurrentDispatcher:R,ReactCurrentBatchConfig:k,ReactCurrentOwner:E,IsSomeRendererActing:{current:!1},assign:r}},V={default:M},X=V&&M||V;e.exports=X.default||X},110:function(e,t,n){"use strict";var r=Object.getOwnPropertySymbols,a=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable;function i(e){if(null==e)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(e)}e.exports=function(){try{if(!Object.assign)return!1;var e=new String("abc");if(e[5]="de","5"===Object.getOwnPropertyNames(e)[0])return!1;for(var t={},n=0;n<10;n++)t["_"+String.fromCharCode(n)]=n;if("0123456789"!==Object.getOwnPropertyNames(t).map((function(e){return t[e]})).join(""))return!1;var r={};return"abcdefghijklmnopqrst".split("").forEach((function(e){r[e]=e})),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},r)).join("")}catch(a){return!1}}()?Object.assign:function(e,t){for(var n,c,l=i(e),u=1;u<arguments.length;u++){for(var s in n=Object(arguments[u]))a.call(n,s)&&(l[s]=n[s]);if(r){c=r(n);for(var p=0;p<c.length;p++)o.call(n,c[p])&&(l[c[p]]=n[c[p]])}}return l}},79:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return i})),n.d(t,"metadata",(function(){return c})),n.d(t,"toc",(function(){return l})),n.d(t,"default",(function(){return s}));var r=n(3),a=n(7),o=(n(108),n(107)),i={id:"recipes",title:"Recipes",hide_title:!0},c={unversionedId:"recipes",id:"recipes",isDocsHomePage:!1,title:"Recipes",description:"Recipes",source:"@site/../docs/Recipes.md",slug:"/recipes",permalink:"/docs/recipes",editUrl:"https://github.com/redux-saga/redux-saga/edit/master/docs/../docs/Recipes.md",version:"current",sidebar:"docs",previous:{title:"Using Run Saga",permalink:"/docs/advanced/UsingRunSaga"},next:{title:"External Resources",permalink:"/docs/ExternalResources"}},l=[{value:"Throttling",id:"throttling",children:[]},{value:"Debouncing",id:"debouncing",children:[]},{value:"Retrying XHR calls",id:"retrying-xhr-calls",children:[]},{value:"Undo",id:"undo",children:[]}],u={toc:l};function s(e){var t=e.components,n=Object(a.a)(e,["components"]);return Object(o.b)("wrapper",Object(r.a)({},u,n,{components:t,mdxType:"MDXLayout"}),Object(o.b)("h1",{id:"recipes"},"Recipes"),Object(o.b)("h2",{id:"throttling"},"Throttling"),Object(o.b)("p",null,"You can throttle a sequence of dispatched actions by using a handy built-in ",Object(o.b)("inlineCode",{parentName:"p"},"throttle")," helper. For example, suppose the UI fires an ",Object(o.b)("inlineCode",{parentName:"p"},"INPUT_CHANGED")," action while the user is typing in a text field."),Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre",className:"language-javascript"},"import { throttle } from 'redux-saga/effects'\n\nfunction* handleInput(input) {\n  // ...\n}\n\nfunction* watchInput() {\n  yield throttle(500, 'INPUT_CHANGED', handleInput)\n}\n")),Object(o.b)("p",null,"By using this helper the ",Object(o.b)("inlineCode",{parentName:"p"},"watchInput")," won't start a new ",Object(o.b)("inlineCode",{parentName:"p"},"handleInput")," task for 500ms, but in the same time it will still be accepting the latest ",Object(o.b)("inlineCode",{parentName:"p"},"INPUT_CHANGED")," actions into its underlaying ",Object(o.b)("inlineCode",{parentName:"p"},"buffer"),", so it'll miss all ",Object(o.b)("inlineCode",{parentName:"p"},"INPUT_CHANGED")," actions happening in-between. This ensures that the Saga will take at most one ",Object(o.b)("inlineCode",{parentName:"p"},"INPUT_CHANGED")," action during each period of 500ms and still be able to process trailing action."),Object(o.b)("h2",{id:"debouncing"},"Debouncing"),Object(o.b)("p",null,"From redux-saga@v1 ",Object(o.b)("a",{parentName:"p",href:"/docs/api#debouncems-pattern-saga-args"},"debounce")," is built-in effect."),Object(o.b)("p",null,"Let's consider how the effect could be implemented as a combination of other base effects."),Object(o.b)("p",null,"To debounce a sequence, put the built-in ",Object(o.b)("inlineCode",{parentName:"p"},"delay")," helper in the forked task:"),Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre",className:"language-javascript"},"\nimport { call, cancel, fork, take, delay } from 'redux-saga/effects'\n\nfunction* handleInput(input) {\n  // debounce by 500ms\n  yield delay(500)\n  ...\n}\n\nfunction* watchInput() {\n  let task\n  while (true) {\n    const { input } = yield take('INPUT_CHANGED')\n    if (task) {\n      yield cancel(task)\n    }\n    task = yield fork(handleInput, input)\n  }\n}\n")),Object(o.b)("p",null,"In the above example ",Object(o.b)("inlineCode",{parentName:"p"},"handleInput")," waits for 500ms before performing its logic. If the user types something during this period we'll get more ",Object(o.b)("inlineCode",{parentName:"p"},"INPUT_CHANGED")," actions. Since ",Object(o.b)("inlineCode",{parentName:"p"},"handleInput")," will still be blocked in the ",Object(o.b)("inlineCode",{parentName:"p"},"delay")," call, it'll be cancelled by ",Object(o.b)("inlineCode",{parentName:"p"},"watchInput")," before it can start performing its logic."),Object(o.b)("p",null,"Example above could be rewritten with redux-saga ",Object(o.b)("inlineCode",{parentName:"p"},"takeLatest")," helper:"),Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre",className:"language-javascript"},"\nimport { call, takeLatest, delay } from 'redux-saga/effects'\n\nfunction* handleInput({ input }) {\n  // debounce by 500ms\n  yield delay(500)\n  ...\n}\n\nfunction* watchInput() {\n  // will cancel current running handleInput task\n  yield takeLatest('INPUT_CHANGED', handleInput);\n}\n")),Object(o.b)("h2",{id:"retrying-xhr-calls"},"Retrying XHR calls"),Object(o.b)("p",null,"From redux-saga@v1 ",Object(o.b)("a",{parentName:"p",href:"/docs/api#retrymaxtries-delay-fn-args"},"retry")," is built-in effect."),Object(o.b)("p",null,"Let's consider how the effect could be implemented as a combination of other base effects."),Object(o.b)("p",null,"To retry an XHR call for a specific amount of times, use a for loop with a delay:"),Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre",className:"language-javascript"},"\nimport { call, put, take, delay } from 'redux-saga/effects'\n\nfunction* updateApi(data) {\n  for(let i = 0; i < 5; i++) {\n    try {\n      const apiResponse = yield call(apiRequest, { data });\n      return apiResponse;\n    } catch(err) {\n      if(i < 4) {\n        yield delay(2000);\n      }\n    }\n  }\n  // attempts failed after 5 attempts\n  throw new Error('API request failed');\n}\n\nexport default function* updateResource() {\n  while (true) {\n    const { data } = yield take('UPDATE_START');\n    try {\n      const apiResponse = yield call(updateApi, data);\n      yield put({\n        type: 'UPDATE_SUCCESS',\n        payload: apiResponse.body,\n      });\n    } catch (error) {\n      yield put({\n        type: 'UPDATE_ERROR',\n        error\n      });\n    }\n  }\n}\n\n")),Object(o.b)("p",null,"In the above example the ",Object(o.b)("inlineCode",{parentName:"p"},"apiRequest")," will be retried for 5 times, with a delay of 2 seconds in between. After the 5th failure, the exception thrown will get caught by the parent saga, which will dispatch the ",Object(o.b)("inlineCode",{parentName:"p"},"UPDATE_ERROR")," action."),Object(o.b)("p",null,"If you want unlimited retries, then the ",Object(o.b)("inlineCode",{parentName:"p"},"for")," loop can be replaced with a ",Object(o.b)("inlineCode",{parentName:"p"},"while (true)"),". Also instead of ",Object(o.b)("inlineCode",{parentName:"p"},"take")," you can use ",Object(o.b)("inlineCode",{parentName:"p"},"takeLatest"),", so only the last request will be retried. By adding an ",Object(o.b)("inlineCode",{parentName:"p"},"UPDATE_RETRY")," action in the error handling, we can inform the user that the update was not successful but it will be retried."),Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre",className:"language-javascript"},"import { delay } from 'redux-saga/effects'\n\nfunction* updateApi(data) {\n  while (true) {\n    try {\n      const apiResponse = yield call(apiRequest, { data });\n      return apiResponse;\n    } catch(error) {\n      yield put({\n        type: 'UPDATE_RETRY',\n        error\n      })\n      yield delay(2000);\n    }\n  }\n}\n\nfunction* updateResource({ data }) {\n  const apiResponse = yield call(updateApi, data);\n  yield put({\n    type: 'UPDATE_SUCCESS',\n    payload: apiResponse.body,\n  });\n}\n\nexport function* watchUpdateResource() {\n  yield takeLatest('UPDATE_START', updateResource);\n}\n\n")),Object(o.b)("h2",{id:"undo"},"Undo"),Object(o.b)("p",null,"The ability to undo respects the user by allowing the action to happen smoothly\nfirst and foremost before assuming they don't know what they are doing. ",Object(o.b)("a",{parentName:"p",href:"https://goodui.org/#8"},"GoodUI"),"\nThe ",Object(o.b)("a",{parentName:"p",href:"https://redux.js.org/recipes/implementing-undo-history#understanding-undo-history"},"redux documentation")," describes a\nrobust way to implement an undo based on modifying the reducer to contain ",Object(o.b)("inlineCode",{parentName:"p"},"past"),", ",Object(o.b)("inlineCode",{parentName:"p"},"present"),",\nand ",Object(o.b)("inlineCode",{parentName:"p"},"future")," state.  There is even a library ",Object(o.b)("a",{parentName:"p",href:"https://github.com/omnidan/redux-undo"},"redux-undo")," that\ncreates a higher order reducer to do most of the heavy lifting for the developer."),Object(o.b)("p",null,"However, this method comes with overhead because it stores references to the previous state(s) of the application."),Object(o.b)("p",null,"Using redux-saga's ",Object(o.b)("inlineCode",{parentName:"p"},"delay")," and ",Object(o.b)("inlineCode",{parentName:"p"},"race")," we can implement a basic, one-time undo without enhancing\nour reducer or storing the previous state."),Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre",className:"language-javascript"},"import { take, put, call, spawn, race, delay } from 'redux-saga/effects'\nimport { updateThreadApi, actions } from 'somewhere'\n\nfunction* onArchive(action) {\n\n  const { threadId } = action\n  const undoId = `UNDO_ARCHIVE_${threadId}`\n\n  const thread = { id: threadId, archived: true }\n\n  // show undo UI element, and provide a key to communicate\n  yield put(actions.showUndo(undoId))\n\n  // optimistically mark the thread as `archived`\n  yield put(actions.updateThread(thread))\n\n  // allow the user 5 seconds to perform undo.\n  // after 5 seconds, 'archive' will be the winner of the race-condition\n  const { undo, archive } = yield race({\n    undo: take(action => action.type === 'UNDO' && action.undoId === undoId),\n    archive: delay(5000)\n  })\n\n  // hide undo UI element, the race condition has an answer\n  yield put(actions.hideUndo(undoId))\n\n  if (undo) {\n    // revert thread to previous state\n    yield put(actions.updateThread({ id: threadId, archived: false }))\n  } else if (archive) {\n    // make the API call to apply the changes remotely\n    yield call(updateThreadApi, thread)\n  }\n}\n\nfunction* main() {\n  while (true) {\n    // wait for an ARCHIVE_THREAD to happen\n    const action = yield take('ARCHIVE_THREAD')\n    // use spawn to execute onArchive in a non-blocking fashion, which also\n    // prevents cancellation when main saga gets cancelled.\n    // This helps us in keeping state in sync between server and client\n    yield spawn(onArchive, action)\n  }\n}\n")))}s.isMDXComponent=!0}}]);